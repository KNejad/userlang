<!doctype html>
<head>

	<title> UserLang | Favorite language finder </title>
</head>
<body>
	<script>
function processName(){
	var username = document.getElementById("form-user-name").value;
	var url = "https://api.github.com/users/" + username + "/repos";
	var languages = {};

	//resets the table to nothing 
	document.getElementById("fav-languages").innerHTML = "";				

	httpGet(url,function getLanguages(response) {
		var githubResult = JSON.parse(response);
		var numContributedRepos = Object.keys(githubResult).length;
		var ajaxReturns =0;
		//parse through each repo and get commits created by username
		//greater than is OK because index starts at 0 so we want to stop counting one before reaching the length of contributedRepos
		for (var repoNum = 0;  repoNum < numContributedRepos; repoNum++){
			httpGet(githubResult[repoNum]["languages_url"], function printLanguages(responce){
				githubResult = JSON.parse(responce);
				for (language in githubResult){
					//checks to see if the language has been added already
					if(language in languages){
						languages[language] = languages[language] + githubResult[language];
					}else{
						languages[language] = githubResult[language];
					}
				}
				ajaxReturns++;

				//when all calls have been processed then this is run
				if( ajaxReturns == numContributedRepos){
					sortedLanguages = sort(languages);
					var output = "<table> <th>Language</th> <th>Lines</th>";
					for (var index =0;  index < sortedLanguages.length; index++){
						output += "<tr><td>" +  sortedLanguages[index][0] + "</td><td>" + sortedLanguages[index][1] +  "</td?</tr>";
						console.log(language);
					}
					output += "</table>"
					document.getElementById("fav-languages").innerHTML = output;				}

			});
		}


	});
	//returns false so page does not refresh
	return false;


}

//sorts a dictionary see http://stackoverflow.com/a/25500462/5922350
function sort(dict){
	var items = Object.keys(dict).map(function(key) {
		return [key, dict[key]];
	});

	items.sort(function(first, second) {
		return second[1] - first[1];
	});

	return items;

}
function httpGet(url, callback){
	var xmlHttp = new XMLHttpRequest();
	xmlHttp.onreadystatechange = function() { 
		if (xmlHttp.readyState == 4 && xmlHttp.status == 200){
			callback(xmlHttp.responseText);
		}
	}
	xmlHttp.open("GET", url, true); 
	xmlHttp.send(null);
}
	</script>

	<form name="search"  onsubmit="return processName()" >
		Username: <input type="text" name="name" id="form-user-name">
		<input type="submit" name="Submit" value="Submit">
	</form>
		<div id="fav-languages"></div>

</body>


</html>



